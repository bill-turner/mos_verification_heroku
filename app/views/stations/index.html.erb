<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/highcharts-more.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>

<%fields=[['Temperature',:tmp],['Dewpoint',:dpt]]%>

<div id="header">Statistical Representation and Verification of GFS/NAM MOS forecasts for the past week.</br>
Check out the source code or help build this app via <a href="http://www.github.com/bill-turner/mos_verification_heroku">Github</a>
</div>

<div id="state_options">
<%=   form_tag("/index", :id=>'state select') do                                                     %>
<%=     label_tag(:userstate,"First Select a State:")                           %>
<%=     select_tag(:userstate,options_for_select(@states,:selected=>session[:userstate]))%>
<%=     submit_tag("Select State")                                              %>
<%    end                                                                       %>
</div>

<div id="station_options">
<%=   form_tag("/index", :id=>'station and variable select') do                                                                    %>
<%=     label_tag(:userstation, "StationID:")                                                  %>
<%=     select_tag(:userstation,options_for_select(@stations, :selected=>session[:userstation])) %>
<%=     select_tag(:userfield,options_for_select(fields, :selected=>session[:userfield]))       %>
<%=     submit_tag("Submit")                                                                   %>
<%    end                                                                                      %>
</div>

<div id="plot_window"></div>
<div id="windrose"></div>
</br></br></br>
<div id="footnote"> Click and drag over the line graph to zoom. Click on the name of the series
  in the chart legend to remove that series from the graph.</div>
<script type='text/javascript'>

$(document).ready(function(){
    chart = new Highcharts.Chart({
        chart: {
            renderTo: 'plot_window',
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            zoomType: 'x'
        },
        rangeSelector: {
	    	selected: 1
	    },
        colors: ['#0000CC','#00FF00','#00CC00','#00AA00','#009900', '#FF0000','#BB0000'],
        legend: {
            itemStyle: {
                fontSize: '16px'
                }
        },
        scrollbar: {
            enabled: true
        },
        title: {
            text: <%= raw @titlestring.to_json %>,
            style: {
                fontSize: '22px',
                fontWeight: 'bold'
            }
        },
        tooltip: {
            shared: true,
            useHTML: true,
            headerFormat: '<small>{point.key}</small><table>',
            pointFormat: '<tr><td style="color: {series.color}">{series.name}: </td>' +
            '<td style="text-align: right"><b>{point.y}</b></td></tr>',
            footerFormat: '</table>',
            valueDecimals: 1
        },
        xAxis: {
            type: 'datetime',
            labels: {
                style: {
                    fontSize: '16px'
                }
            }
        },
        yAxis: {
            title: {
                text: <%= raw @var.to_json %>,
                style: {
                    fontSize: '18px'
                }
            },
            labels: {
                style: {
                    fontSize: '14px'
                }
            }
        },
        series: [{
            type: 'spline',
            name: 'SFC OBS',
            data: <%= @obs.to_json %>
        },
        {
            type: 'spline',
            name: 'GFS 00Z',
            data: <%= @gfs0Z.to_json %>
        },
        {   type: 'spline',
            name: 'GFS 06Z',
            data: <%= @gfs06Z.to_json %>
        },
        {   type: 'spline',
            name: 'GFS 12Z',
            data: <%= @gfs12Z.to_json %>
        },
        {
            type: 'spline',
            name: 'GFS 18Z',
            data: <%= @gfs18Z.to_json %>
        },
        {
            type: 'spline',
            name: 'NAM 0Z',
            data: <%= @nam0Z.to_json %>
        },
        {
            type: 'spline',
            name: 'NAM 12Z',
            data: <%= @nam12Z.to_json %>
        }]
    });

    $('#windrose').highcharts({
	    chart: {
	        polar: true,
	        type: 'line'
	    },
        colors: ['#00FF00','#00CC00','#00AA00','#009900', '#FF0000','#BB0000'],
	    title: {
	        text: 'Forecasted Wind for the next 3 days [kts]',
	        x: -30
	    },
	    pane: {
	    	size: '80%'
	    },
	    xAxis: {
	        categories: ['North', 'Northeast', 'East', 'Southeast', 'South',
	        'Southwest','West','Northwest'],
	        tickmarkPlacement: 'between',
	        lineWidth: 0
	    },
	    yAxis: {
	        lineWidth: 0,
	        min: 0
	    },
	    tooltip: {
	    	shared: true,
	        pointFormat: '<span style="color:{series.color}">{series.name}: <b>{point.y:,.0f} kts</b><br/>'
	    },
	    legend: {
	        align: 'right',
	        verticalAlign: 'top',
	        y: 30,
	        layout: 'vertical'
	    },
	    series: [{
            name: 'GFS 0Z',
            data: <%= @gfs0Zwind.to_json %>,
            pointPlacement: 'on'
        },
	    {
            name: 'GFS 06Z',
            data: <%= @gfs06Zwind.to_json %>,
	        pointPlacement: 'on'
	    },
	    {
	        name: 'GFS 12Z',
	        data: <%= @gfs12Zwind.to_json %>,
	        pointPlacement: 'on'
	    },
	    {
	        name: 'GFS 18Z',
	        data: <%= @gfs18Zwind.to_json %>,
	        pointPlacement: 'on'
	    },
	    {
	        name: 'NAM 0Z',
	        data: <%= @nam0Zwind.to_json %>,
	        pointPlacement: 'on'
	    },
	    {
	        name: 'NAM 12Z',
	        data: <%= @nam12Zwind.to_json %>,
	        pointPlacement: 'on'
	    }]
	})
});//document ready function
</script>





